<!DOCTYPE html>
<html>
  
  <head>
    <title>Schedules</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" type="text/css">
    <link rel="stylesheet" href="custom.css" />
    <script src="http://code.jquery.com/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js" type="text/javascript"></script>
  </head>
  
  <body>
    <!-- Home -->
    <div data-role="page" id="schedules" data-theme="b">
      <script language="javascript">
	  $(document).bind('pageinit', function () {
          $('#systemz').bind('change', function (e) {
            $.get("bin/run", {
              system: this.value
            });
          });
        });
		
        $('#schedules').on('pagebeforeshow', function () {
			$.ajax("json/state", {
			async: false, 
			dataType: "json", 
			error: function () { 
				alert ("Communications Failure" ); 
			}, success: function (data) {
				$('#systemz').val(data.run).slider('refresh');
				}
			});
			
          $.ajax("json/schedules", {async: false, dataType: "json", success: function (data) {
            var output = '';
            for (var i = 0; i < data.Table.length; i++) {
              output += '<li><a href="ShSched.htm?id=' + data.Table[i].id + '" data-transition="slide">';
              if (data.Table[i].e == 'off')
                output += "<i>" + data.Table[i].name + " (Disabled)</i>";
              else
                output += data.Table[i].name;
              output += '</a></li>';
            }
            $('#ulListview').empty().append(output).listview('refresh');
          }});
        });
      </script>
		<div data-theme="b" data-role="header"> 
			<a data-role="button" data-direction="reverse" data-rel="back" href="#page1" data-icon="back" data-iconpos="left" class="ui-btn-left">Back</a>
			<a data-role="button" href="ShSched.htm?new=1" data-icon="plus" data-iconpos="left" class="ui-btn-right">Add</a>
			<h3>Schedules</h3>
		</div>
      <div data-role="content">
		<div data-role="fieldcontain">
			  <label for="systemz">Run Schedules</label>
			  <select name="systemz" id="systemz" data-role="slider">
				<option value="off">Off</option>
				<option value="on" selected>On</option>
			  </select>
			</div>
        <div class="content-primary">
          <ul data-role="listview" data-inset="true" id='ulListview'></ul>
        </div>
        <!--/content-primary -->
      </div>
      <div data-role="footer">
        <p>&copy; 2013 Richard Zimmerman</p>
      </div>
    </div>
  </body>

</html>
